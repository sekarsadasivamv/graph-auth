!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("msal"),require("@angular/router"),require("msal/lib-commonjs/utils/UrlUtils"),require("@angular/common"),require("msal/lib-commonjs/utils/WindowUtils"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","rxjs","rxjs/operators","msal","@angular/router","msal/lib-commonjs/utils/UrlUtils","@angular/common","msal/lib-commonjs/utils/WindowUtils","@angular/common/http"],t):t(((e=e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.msal,e.ng.router,e.UrlUtils,e.ng.common,e.WindowUtils,e.ng.common.http)}(this,(function(e,t,r,o,n,a,i,s,c,u){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var p=function(){return(p=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function f(e,t,r,o){var n,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function g(e,t){return function(r,o){t(r,o,e)}}var h=function(){function e(){this._msalSubject=new r.BehaviorSubject(1),this.msalItem$=this._msalSubject.asObservable()}return e.prototype.broadcast=function(e,t){this._msalSubject.next({type:e,payload:t})},e.prototype.getMSALSubject=function(){return this._msalSubject},e.prototype.getMSALItem=function(){return this.msalItem$},e.prototype.subscribe=function(e,t){return this.msalItem$.pipe(o.filter((function(t){return t.type===e})),o.map((function(e){return e.payload}))).subscribe(t)},e=f([t.Injectable()],e)}(),d=function(){function e(e,t,r){this._error="",this._errorDesc="",this._scopes="",this._error=e,t&&(this._errorDesc=t),r&&(this._scopes=r)}return Object.defineProperty(e.prototype,"error",{get:function(){return this._error},set:function(e){this._error=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDesc",{get:function(){return this._errorDesc},set:function(e){this._errorDesc=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scopes",{get:function(){return this._scopes},set:function(e){this._scopes=e},enumerable:!0,configurable:!0}),e}(),m=new t.InjectionToken("MSAL_CONFIG"),y=new t.InjectionToken("MSAL_CONFIG_ANGULAR"),b=function(e){return p(p({},e),{framework:p(p({},e.framework),{isAngular:!0})})},v=function(e){function r(t,r,o,n){var a=e.call(this,b(t))||this;return a.msalConfig=t,a.msalAngularConfig=r,a.router=o,a.broadcastService=n,window.addEventListener("msal:popUpHashChanged",(function(e){a.getLogger().verbose("popUpHashChanged ")})),window.addEventListener("msal:popUpClosed",(function(e){var t=e.detail.split("|"),r=new d(t[0],t[1]);a.getLoginInProgress()?(n.broadcast("msal:loginFailure",r),a.setloginInProgress(!1)):a.getAcquireTokenInProgress()&&(n.broadcast("msal:acquireTokenFailure",r),a.setAcquireTokenInProgress(!1))})),a.router.events.subscribe((function(e){for(var t=0;t<o.config.length;t++)o.config[t].canActivate||a.msalAngularConfig.unprotectedResources&&(a.isUnprotectedResource(o.config[t].path)||a.isEmpty(o.config[t].path)||a.msalAngularConfig.unprotectedResources.push(o.config[t].path))})),a}return function(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(r,e),r.prototype.isUnprotectedResource=function(e){var t=this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources,r=this.msalAngularConfig.unprotectedResources||[];return(t&&t.length?t:r).some((function(t){return e.indexOf(t)>-1}))},r.prototype.isEmpty=function(e){return void 0===e||!e||0===e.length},r.prototype.getCacheStorage=function(){return this.cacheStorage},r.prototype.loginPopup=function(t){var r=this;return e.prototype.loginPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:loginSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:loginFailure",e),r.getLogger().error("Error during login:\n"+e.errorMessage),e}))},r.prototype.acquireTokenSilent=function(t){var r=this;return e.prototype.acquireTokenSilent.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes: "+t.scopes+" "+e),e}))},r.prototype.acquireTokenPopup=function(t){var r=this;return e.prototype.acquireTokenPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes : "+t.scopes+" "+e),e}))},r.prototype.handleRedirectCallback=function(t,r){var o=this;e.prototype.handleRedirectCallback.call(this,(function(e,n){n?("id_token"===n.tokenType?o.broadcastService.broadcast("msal:loginSuccess",n):o.broadcastService.broadcast("msal:acquireTokenSuccess",n),r?t(n):t(null,n)):e&&("id_token"===n.tokenType?o.broadcastService.broadcast("msal:loginFailure",e):o.broadcastService.broadcast("msal:acquireTokenFailure",e),r?r(e,n.accountState):t(e))}))},r.prototype.clearCacheForScope=function(t){return e.prototype.clearCacheForScope.call(this,t)},r.prototype.getScopesForEndpoint=function(t){if(this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources&&this.getLogger().info("msalConfig.framework.unprotectedResources is deprecated, use msalAngularConfig.unprotectedResources"),this.isUnprotectedResource(t))return null;var r=this.msalConfig.framework&&this.msalConfig.framework.protectedResourceMap;r&&this.getLogger().info("msalConfig.framework.protectedResourceMap is deprecated, use msalAngularConfig.protectedResourceMap");var o=r&&r.size?r:new Map(this.msalAngularConfig.protectedResourceMap),n=Array.from(o.keys()).find((function(e){return t.indexOf(e)>-1}));return n?o.get(n):t.indexOf("http://")>-1||t.indexOf("https://")>-1?i.UrlUtils.getHostFromUri(t)===i.UrlUtils.getHostFromUri(e.prototype.getRedirectUri.call(this))?new Array(this.msalConfig.auth.clientId):null:new Array(this.msalConfig.auth.clientId)},r.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[m]}]},{type:void 0,decorators:[{type:t.Inject,args:[y]}]},{type:a.Router},{type:h}]},r=f([t.Injectable(),g(0,t.Inject(m)),g(1,t.Inject(y))],r)}(n.UserAgentApplication),S=function(){function e(e,t,r,o,n,a,i,s){this.msalConfig=e,this.msalAngularConfig=t,this.authService=r,this.router=o,this.activatedRoute=n,this.location=a,this.platformLocation=i,this.broadcastService=s}return e.prototype.canActivate=function(e,t){var r=this;if(this.authService.getLogger().verbose("location change event from old url to new url"),i.UrlUtils.urlContainsHash(window.location.hash)&&c.WindowUtils.isInIframe())return this.authService.getLogger().warning("redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),!1;if(this.authService.getAccount())return this.authService.acquireTokenSilent({scopes:[this.msalConfig.auth.clientId]}).then((function(e){return r.broadcastService.broadcast("msal:loginSuccess",e),!0})).catch((function(e){return r.broadcastService.broadcast("msal:loginFailure",e),!1}));if(this.msalAngularConfig.popUp)return this.authService.loginPopup({scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters}).then((function(){return!0})).catch((function(){return!1}));var o=""+window.location.origin+t.url;this.authService.loginRedirect({redirectStartPage:o,scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters})},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[m]}]},{type:void 0,decorators:[{type:t.Inject,args:[y]}]},{type:v},{type:a.Router},{type:a.ActivatedRoute},{type:s.Location},{type:s.PlatformLocation},{type:h}]},e=f([t.Injectable(),g(0,t.Inject(m)),g(1,t.Inject(y))],e)}(),j=function(){function e(e,t){this.auth=e,this.broadcastService=t}return e.prototype.intercept=function(e,t){var n,a=this,i=this.auth.getScopesForEndpoint(e.url);return this.auth.getLogger().verbose("Url: "+e.url+" maps to scopes: "+i),i?r.from(this.auth.acquireTokenSilent({scopes:i}).then((function(t){n=t.accessToken;var r="Bearer "+t.accessToken;return e.clone({setHeaders:{Authorization:r}})}))).pipe(o.mergeMap((function(e){return t.handle(e)})),o.tap((function(e){}),(function(e){e instanceof u.HttpErrorResponse&&401===e.status&&(a.auth.clearCacheForScope(n),a.broadcastService.broadcast("msal:notAuthorized",e.message))}))):t.handle(e)},e.ctorParameters=function(){return[{type:v},{type:h}]},e=f([t.Injectable()],e)}(),w={consentScopes:[],popUp:!1,extraQueryParameters:{},unprotectedResources:[],protectedResourceMap:[]},C=function(){function e(){}var r;return r=e,e.forRoot=function(e,t){return void 0===t&&(t=w),{ngModule:r,providers:[{provide:m,useValue:e},{provide:y,useValue:t},v]}},e=r=f([t.NgModule({imports:[s.CommonModule],declarations:[],providers:[S,h]})],e)}();e.BroadcastService=h,e.MSAL_CONFIG=m,e.MSAL_CONFIG_ANGULAR=y,e.MsalGuard=S,e.MsalInterceptor=j,e.MsalModule=C,e.MsalService=v,e.ɵa=w,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map